import{d as z,o as x,c as U,w as s,S as ie,a as u,r as ce,u as e,N as de,R as pe,b as Z,e as m,f as ee,g as k,h as te,i as ue,j as C,k as T,l as V,m as se,n as le,p as I,q,s as G,t as J,v as A,x as H,A as K,y as Q,z as X,B as E,C as N,D as fe,E as he,F as W,G as ge,H as $,I as Y,J as me,K as L,L as ve,M as Fe,O as we,P as be,Q as Be,T as _e,U as ye}from"./vendor.59ba76df.js";const Ce=function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))p(r);new MutationObserver(r=>{for(const f of r)if(f.type==="childList")for(const S of f.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&p(S)}).observe(document,{childList:!0,subtree:!0});function F(r){const f={};return r.integrity&&(f.integrity=r.integrity),r.referrerpolicy&&(f.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?f.credentials="include":r.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function p(r){if(r.ep)return;r.ep=!0;const f=F(r);fetch(r.href,f)}};Ce();const Se=z({setup(O){return(v,F)=>(x(),U(e(pe),null,{default:s(({Component:p})=>[(x(),U(ie,null,{default:s(()=>[u(e(de),null,{default:s(()=>[(x(),U(ce(p)))]),_:2},1024)]),_:2},1024))]),_:1}))}});const xe=E("\u65B0\u5EFA\u8868\u5355"),Re=A("p",null,"\u7B2C\u4E00\u6B65 \u8BF7\u8F93\u5165\u6807\u9898",-1),De=A("p",null,"\u7B2C\u4E8C\u6B65 \u8BF7\u4E0A\u4F20\u5236\u4F5C\u597D\u7684\u8868\u5355\u6A21\u677F\u6587\u4EF6",-1),Ue={style:{"margin-bottom":"12px"}},Ee=E("\u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20"),ke=A("p",null,"\u8BF7\u4E0A\u4F20\u5236\u4F5C\u597D\u7684\u7528\u6237\u5BFC\u5165\u6A21\u677F\u6587\u4EF6",-1),Ne={style:{"margin-bottom":"12px"}},Ae=E("\u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20"),Le=z({setup(O){const v=Z();let F=()=>localStorage.getItem("x-api-subuser-code")||"",p="https://xlsx-collecter-api.imhcg.cn",r={loginByAccount:"https://account.imhcg.cn/to/aae1cf3cb358fab3f0685775655dc000",getUserSheets:"/api/user/sheets",createSheetByXlsx:"/api/sheet/create",importSubusersFormXlsx(o){return`/api/user/${o}/subusers/import`}},f=m({}),S=m([]);function h(o){return String(o)}let D={request(o="GET",n="http://",c=void 0){let _={"x-api-code":F()||"apiCode"};return fetch(n,{method:o,headers:_,body:c,mode:"cors"})},checkLocalApiCode(){const o=te();o.query.code&&o.query.code.length===129?localStorage.setItem("x-api-code",h(o.query.code)):F()==""&&location.assign(r.loginByAccount)},createSheetByXlsx(o,n){this.request("POST",p+r.createSheetByXlsx,o).then(c=>{c.status===200?n(!0):n(!1)})},createSubUserByXlsx(o,n){this.request("POST",p+r.importSubusersFormXlsx(f.value.id),o).then(c=>{c.status===200?n(!0):n(!1)})},getUserSheets(){this.request("GET",p+r.getUserSheets,void 0).then(o=>{o.status==200&&o.json().then(n=>{S.value=[],Object.keys(n).forEach(c=>{S.value.push({id:c,title:n[c].title,create_at:n[c].create_at})})})})}};D.checkLocalApiCode(),D.getUserSheets();let g=m(!1),d=m(!1);const B=[{title:"\u540D\u79F0",key:"title",render(o){return N(C,{strong:!0,secondary:!0,size:"medium",type:"info",onClick:()=>v.push("/sheet?sheet_id="+o.id)},{default:()=>o.title})}},{title:"\u6807\u8BC6",key:"id"},{title:"\u521B\u5EFA\u65F6\u95F4",key:"create_at",render(o){return N(fe,{time:o.create_at,format:"yyyy-MM-dd HH:mm:ss"})}},{title:"\u64CD\u4F5C",render(o){return N(C,{strong:!0,secondary:!0,size:"medium",type:"info",onClick:()=>{f.value=o,d.value=!0}},{default:()=>"\u5BFC\u5165\u6570\u636E\u5F55\u5165\u5458"})}}],w=m(""),R=ee();function j(o,n,c){if(console.log(w),w.value==""){R.warning("\u8BF7\u586B\u5199\u6807\u9898");return}console.log(o,n,c);var _=new FormData;return _.append("file",o.file.file),_.append("title",w.value),D.createSheetByXlsx(_,t=>{t?(R.success("\u65B0\u5EFA\u6210\u529F"),D.getUserSheets(),g.value=!g.value):(R.warning("\u65B0\u5EFA\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"),g.value=!g.value)}),!0}function i(o,n,c){console.log(o,n,c);var _=new FormData;_.append("file",o.file.file),D.createSubUserByXlsx(_,t=>{t?(R.success("\u5BFC\u5165\u6210\u529F"),d.value=!1):(R.warning("\u5BFC\u5165\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"),d.value=!1)})}return(o,n)=>(x(),U(e(k),{vertical:"",size:"large"},{default:s(()=>[u(e(ue),{"content-style":"padding: 24px;"},{default:s(()=>[u(e(V),{style:{"margin-bottom":"12px"}},{default:s(()=>[u(e(C),{onClick:n[0]||(n[0]=c=>T(g)?g.value=!e(g):g=!e(g))},{default:s(()=>[xe]),_:1})]),_:1}),u(e(le),null,{default:s(()=>[u(e(se),{columns:B,data:e(S)},null,8,["data"])]),_:1}),u(e(X),{show:e(g),"onUpdate:show":n[2]||(n[2]=c=>T(g)?g.value=c:g=c),width:600},{default:s(()=>[u(e(I),{title:"\u521B\u5EFA\u8868\u5355",closable:""},{default:s(()=>[u(e(k),{vertical:""},{default:s(()=>[Re,u(e(q),{value:w.value,"onUpdate:value":n[1]||(n[1]=c=>w.value=c),type:"text",placeholder:"\u8F93\u5165\u8868\u5355\u7684\u6807\u9898",clearable:""},null,8,["value"]),De,u(e(G),{"on-change":j,"default-upload":!1,accept:".xlsx"},{default:s(()=>[u(e(J),null,{default:s(()=>[A("div",Ue,[u(e(H),{size:"100",depth:3},{default:s(()=>[u(e(K))]),_:1})]),u(e(Q),{style:{"font-size":"16px"}},{default:s(()=>[Ee]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),u(e(X),{show:e(d),"onUpdate:show":n[3]||(n[3]=c=>T(d)?d.value=c:d=c),width:600},{default:s(()=>[u(e(I),{title:"\u5BFC\u5165\u7528\u6237\u81F3 "+e(f).title,closable:""},{default:s(()=>[u(e(k),{vertical:""},{default:s(()=>[ke,u(e(G),{"on-change":i,"default-upload":!1,accept:".xlsx"},{default:s(()=>[u(e(J),null,{default:s(()=>[A("div",Ne,[u(e(H),{size:"100",depth:3},{default:s(()=>[u(e(K))]),_:1})]),u(e(Q),{style:{"font-size":"16px"}},{default:s(()=>[Ae]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])]),_:1})]),_:1}))}});const Te=E("\u9A8C\u8BC1"),Ve=E("\u65B0\u589E\u6570\u636E"),qe=E("\u65B0\u589E"),Oe=E("\u66F4\u65B0"),je=z({setup(O){const v="https://xlsx-collecter-api.imhcg.cn",F={login(t){return`/api/user/${t}/subuser/login`},getSheetColumns(t){return`/api/sheet/${t}/columns`},getRowsFromDb(t){return`/api/sheet/${t}/rows`},insertRowToDb(t){return`/api/sheet/${t}/row/insert`},updateRowToDb(t,l){return`/api/sheet/${t}/row/${l}/update`},deleteRowFromDb(t,l){return`/api/sheet/${t}/row/${l}/delete`},outputToXlsxFile(t,l){return`/api/sheet/${t}/rows/${l}/xlsx`}};let p=m(""),r=m({account:"",password:"",name:()=>localStorage.getItem("name")});m([]);let f=m([]),S=m([]),h=m({}),D=m([]),g=m([]),d=m({subUserLoginVisible:!1,createNewRowDrawerVisible:!1}),B=m("");Z();const w=ee();let R=()=>localStorage.getItem("x-api-subuser-code")||"";function j(t){return String(t)}let i={request(t="GET",l="http://",a=void 0,b="application/json"){let y={"x-api-code":R(),"content-type":b};return fetch(l,{method:t,headers:y,body:a,mode:"cors"})},resetLoginStatus(){delete localStorage["x-api-subuser-code"],delete localStorage.name,d.value.subUserLoginVisible=!0},checkSheetIdAndApiCode(){const t=te();t.query.sheet_id&&t.query.sheet_id.length==32?(p.value=j(t.query.sheet_id),console.log("checkSheetIdAndApiCode",p)):location.assign("/"),R?(i.getSubUserColumns(),i.getSubUserRows()):d.value.subUserLoginVisible=!0},sheetSubuserLogin(t){i.request("POST",v+F.login(p.value),JSON.stringify({account:r.value.account,password:r.value.password}),"application/json").then(l=>{if(l.status==200)return l.json().then(a=>{console.log("sheetSubuserLogin",a),localStorage.setItem("x-api-subuser-code",a["x-api-subuser-code"]),localStorage.setItem("name",a.name),t(!0)});t(!1)})},getSubUserRows(){i.request("GET",v+F.getRowsFromDb(p.value),void 0).then(t=>{if(t.status!=200){i.resetLoginStatus();return}else t.json().then(l=>{console.log("getSubUserRows",l),f.value=l})})},resetCurrentRow(){let t=JSON.parse(JSON.stringify(h.value||{}));Object.keys(S).forEach(l=>{t[l]=""}),h.value=t,console.log("resetCurrentRow",h)},getSubUserColumns(){i.request("GET",v+F.getSheetColumns(p.value),void 0).then(t=>{if(t.status!=200){this.resetLoginStatus();return}else t.json().then(l=>{S=l;let a=[];Object.keys(l).forEach(y=>{a.push({key:y,title:l[y].name})}),D.value=a.slice();const b={title:"\u64CD\u4F5C",render(y){let P=[];const oe=N(C,{strong:!0,secondary:!0,type:"info",onClick:()=>{console.log("\u66F4\u65B0",y,this),h.value=y,B.value="\u66F4\u65B0",d.value.createNewRowDrawerVisible=!0}},{default:()=>"\u4FEE\u6539"}),ae=N(C,{strong:!0,secondary:!0,type:"info",style:"margin-left:5px;",onClick:()=>{console.log("\u5220\u9664",y),h.value=y,confirm("\u786E\u8BA4\u5220\u9664\u5417?")&&i.deleteRow(ne=>{ne?i.getSubUserRows():alert("\u5220\u9664\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458")})}},{default:()=>"\u5220\u9664"}),re=N(C,{strong:!0,secondary:!0,type:"info",style:"margin-left:5px;",onClick:()=>{console.log("\u5BFC\u51FA",y),h.value=y,i.outputToXlsxFile()}},{default:()=>"To Xlsx"});return P.push([oe,ae,re]),P}};a.push(b),g.value=a,console.log("tableColumns",g)})})},insertRow(t){i.request("POST",v+F.insertRowToDb(p.value),JSON.stringify(h.value),"application/json").then(l=>{l.status==200?t(!0):t(!1)})},updateRow(t){i.request("POST",v+F.updateRowToDb(p.value,h.value.rowid),JSON.stringify(h.value),"application/json").then(l=>{l.status==200?t(!0):t(!1)})},deleteRow(t){i.request("POST",v+F.deleteRowFromDb(p.value,h.value.rowid),void 0,"application/json").then(l=>{l.status==200?t(!0):t(!1)})},outputToXlsxFile(){i.request("GET",v+F.outputToXlsxFile(p.value,h.value.rowid),void 0,"application/json").then(t=>{t.status==200&&t.blob().then(l=>{let a=URL.createObjectURL(l),b=document.createElement("a");b.style.display="none",b.href=a,b.download="\u5BFC\u51FA\u6570\u636E-"+h.value[Object.keys(h.value)[1]]+".xlsx",b.click(),URL.revokeObjectURL(a),document.body.removeChild(b)})})}};const o={account:{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"},password:{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:["input","blur"]}},n=m(null);function c(t){var l;t.preventDefault(),(l=n.value)==null||l.validate(a=>{a?(console.log(a),w.error("\u8BF7\u5B8C\u5584\u767B\u5F55\u4FE1\u606F")):(console.log("\u5C1D\u8BD5\u767B\u5F55"),i.sheetSubuserLogin(b=>{b?(w.success("\u767B\u5F55\u6210\u529F"),d.value.subUserLoginVisible=!1,i.getSubUserColumns(),i.getSubUserRows()):w.error("\u767B\u5F55\u5931\u8D25")}))})}function _(){B.value=="\u65B0\u589E"&&i.insertRow(t=>{t?(w.success("\u65B0\u589E\u6210\u529F"),d.value.createNewRowDrawerVisible=!1,i.getSubUserRows()):w.error("\u65B0\u589E\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458")}),B.value=="\u66F4\u65B0"&&i.updateRow(t=>{t?(w.success("\u66F4\u65B0\u6210\u529F"),d.value.createNewRowDrawerVisible=!1,i.getSubUserRows()):w.error("\u66F4\u65B0\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458")}),console.log("saveRow",h)}return he(()=>{console.log("onMounted"),i.checkSheetIdAndApiCode()}),(t,l)=>(x(),W(Y,null,[u(e(ge),{show:e(d).subUserLoginVisible,"onUpdate:show":l[2]||(l[2]=a=>e(d).subUserLoginVisible=a),"mask-closable":!1,"close-on-esc":!1,"auto-focus":""},{default:s(()=>[u(e(me),{style:{width:"600px"},title:"\u9700\u8981\u767B\u5F55",bordered:!0,size:"huge",role:"dialog","aria-modal":"true"},{default:s(()=>[u(e(ve),{ref_key:"formRef",ref:n,inline:"","label-width":80,model:e(r),rules:o,size:"medium"},{default:s(()=>[u(e(L),{label:"\u7528\u6237\u540D",path:"account"},{default:s(()=>[u(e(q),{value:e(r).account,"onUpdate:value":l[0]||(l[0]=a=>e(r).account=a),placeholder:"\u8F93\u5165\u8D26\u53F7"},null,8,["value"])]),_:1}),u(e(L),{label:"\u5BC6\u7801",path:"password"},{default:s(()=>[u(e(q),{value:e(r).password,"onUpdate:value":l[1]||(l[1]=a=>e(r).password=a),placeholder:"\u8F93\u5165\u5BC6\u7801"},null,8,["value"])]),_:1}),u(e(L),null,{default:s(()=>[u(e(C),{"attr-type":"button",onClick:c},{default:s(()=>[Te]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"]),e(R)()?(x(),U(e(k),{key:0,vertical:"",size:"large"},{default:s(()=>[u(e(ue),{"content-style":"padding: 24px;"},{default:s(()=>[u(e(k),{justify:"space-between"},{default:s(()=>[u(e(V),{style:{"margin-bottom":"12px"}},{default:s(()=>[u(e(C),{onClick:l[3]||(l[3]=a=>(T(B)?B.value="\u65B0\u589E":B="\u65B0\u589E",e(i).resetCurrentRow(),e(d).createNewRowDrawerVisible=!0))},{default:s(()=>[Ve]),_:1})]),_:1}),u(e(V),{style:{"margin-bottom":"12px"}},{default:s(()=>[u(e(C),{onClick:e(i).resetLoginStatus},{default:s(()=>[E("\u6CE8\u9500 "+Fe(e(r).name()),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),u(e(le),null,{default:s(()=>[u(e(se),{columns:e(g),data:e(f)},null,8,["columns","data"])]),_:1})]),_:1})]),_:1})):$("",!0),u(e(X),{show:e(d).createNewRowDrawerVisible,"onUpdate:show":l[4]||(l[4]=a=>e(d).createNewRowDrawerVisible=a),width:600},{default:s(()=>[u(e(I),{title:e(B),closable:""},{default:s(()=>[u(e(k),{vertical:""},{default:s(()=>[(x(!0),W(Y,null,we(e(D),a=>(x(),U(e(L),{key:a.key+"",label:a.title},{default:s(()=>[u(e(q),{value:e(h)[a.key],"onUpdate:value":b=>e(h)[a.key]=b,type:"text",placeholder:a.title,clearable:""},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["label"]))),128)),u(e(V),{style:{"margin-bottom":"12px"}},{default:s(()=>[e(B)=="\u65B0\u589E"?(x(),U(e(C),{key:0,onClick:_},{default:s(()=>[qe]),_:1})):$("",!0),e(B)=="\u66F4\u65B0"?(x(),U(e(C),{key:1,onClick:_},{default:s(()=>[Oe]),_:1})):$("",!0)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])],64))}}),$e=be({history:Be(),routes:[{path:"/",name:"user",component:Le},{path:"/sheet",name:"sheet",component:je}]}),M=_e(Se);M.use(ye());M.use($e);M.mount("#app");
