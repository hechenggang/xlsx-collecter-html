import{d as M,o as R,c as E,w as s,S as ce,a as u,r as fe,u as e,N as pe,R as ge,b as te,e as h,f as ue,g as N,h as se,i as le,j as C,k as V,l as q,m as oe,n as ae,p as X,q as O,s as H,t as K,v as L,x as Q,A as W,y as Y,z,B as k,C as A,D as he,E as ve,F as Z,G as me,H as I,I as ee,J as Fe,K as T,L as we,M as be,O as Be,P as _e,Q as ye,T as Ce,U as Se}from"./vendor.59ba76df.js";const xe=function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))f(r);new MutationObserver(r=>{for(const p of r)if(p.type==="childList")for(const S of p.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&f(S)}).observe(document,{childList:!0,subtree:!0});function F(r){const p={};return r.integrity&&(p.integrity=r.integrity),r.referrerpolicy&&(p.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?p.credentials="include":r.crossorigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function f(r){if(r.ep)return;r.ep=!0;const p=F(r);fetch(r.href,p)}};xe();const Re=M({setup(j){return(m,F)=>(R(),E(e(ge),null,{default:s(({Component:f})=>[(R(),E(ce,null,{default:s(()=>[u(e(pe),null,{default:s(()=>[(R(),E(fe(f)))]),_:2},1024)]),_:2},1024))]),_:1}))}});const De=k("\u65B0\u5EFA\u8868\u5355"),Ue=L("p",null,"\u7B2C\u4E00\u6B65 \u8BF7\u8F93\u5165\u6807\u9898",-1),Ee=L("p",null,"\u7B2C\u4E8C\u6B65 \u8BF7\u4E0A\u4F20\u5236\u4F5C\u597D\u7684\u8868\u5355\u6A21\u677F\u6587\u4EF6",-1),ke={style:{"margin-bottom":"12px"}},Ne=k("\u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20"),Ae=L("p",null,"\u8BF7\u4E0A\u4F20\u5236\u4F5C\u597D\u7684\u7528\u6237\u5BFC\u5165\u6A21\u677F\u6587\u4EF6",-1),Le={style:{"margin-bottom":"12px"}},Te=k("\u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20"),Ve=M({setup(j){const m=te();let F=()=>localStorage.getItem("x-api-subuser-code")||"",f="https://xlsx-collecter-api.imhcg.cn",r={loginByAccount:"https://account.imhcg.cn/to/aae1cf3cb358fab3f0685775655dc000",getUserSheets:"/api/user/sheets",createSheetByXlsx:"/api/sheet/create",importSubusersFormXlsx(o){return`/api/user/${o}/subusers/import`}},p=h({}),S=h([]);function g(o){return String(o)}let U={request(o="GET",n="http://",i=void 0){let x={"x-api-code":F()||"apiCode"};return fetch(n,{method:o,headers:x,body:i,mode:"cors"})},checkLocalApiCode(){const o=se();o.query.code&&o.query.code.length===129?localStorage.setItem("x-api-code",g(o.query.code)):F()==""&&location.assign(r.loginByAccount)},createSheetByXlsx(o,n){this.request("POST",f+r.createSheetByXlsx,o).then(i=>{i.status===200?n(!0):n(!1)})},createSubUserByXlsx(o,n){this.request("POST",f+r.importSubusersFormXlsx(p.value.id),o).then(i=>{i.status===200?n(!0):n(!1)})},getUserSheets(){this.request("GET",f+r.getUserSheets,void 0).then(o=>{o.status==200&&o.json().then(n=>{S.value=[],Object.keys(n).forEach(i=>{S.value.push({id:i,title:n[i].title,create_at:n[i].create_at})})})})}};U.checkLocalApiCode(),U.getUserSheets();let v=h(!1),c=h(!1);const B=[{title:"\u540D\u79F0",key:"title",render(o){return A(C,{strong:!0,secondary:!0,size:"medium",type:"info",onClick:()=>m.push("/sheet?sheet_id="+o.id)},{default:()=>o.title})}},{title:"\u6807\u8BC6",key:"id"},{title:"\u521B\u5EFA\u65F6\u95F4",key:"create_at",render(o){return A(he,{time:o.create_at,format:"yyyy-MM-dd HH:mm:ss"})}},{title:"\u64CD\u4F5C",render(o){return A(C,{strong:!0,secondary:!0,size:"medium",type:"info",onClick:()=>{p.value=o,c.value=!0}},{default:()=>"\u5BFC\u5165\u6570\u636E\u5F55\u5165\u5458"})}}],w=h(""),D=ue();function $(o,n,i){if(console.log(w),w.value==""){D.warning("\u8BF7\u586B\u5199\u6807\u9898");return}console.log(o,n,i);var x=new FormData;return x.append("file",o.file.file),x.append("title",w.value),U.createSheetByXlsx(x,_=>{_?(D.success("\u65B0\u5EFA\u6210\u529F"),U.getUserSheets(),v.value=!v.value):(D.warning("\u65B0\u5EFA\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"),v.value=!v.value)}),!0}function d(o,n,i){console.log(o,n,i);var x=new FormData;x.append("file",o.file.file),U.createSubUserByXlsx(x,_=>{_?(D.success("\u5BFC\u5165\u6210\u529F"),c.value=!1):(D.warning("\u5BFC\u5165\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"),c.value=!1)})}return(o,n)=>(R(),E(e(N),{vertical:"",size:"large"},{default:s(()=>[u(e(le),{"content-style":"padding: 24px;"},{default:s(()=>[u(e(q),{style:{"margin-bottom":"12px"}},{default:s(()=>[u(e(C),{onClick:n[0]||(n[0]=i=>V(v)?v.value=!e(v):v=!e(v))},{default:s(()=>[De]),_:1})]),_:1}),u(e(ae),null,{default:s(()=>[u(e(oe),{columns:B,data:e(S)},null,8,["data"])]),_:1}),u(e(z),{show:e(v),"onUpdate:show":n[2]||(n[2]=i=>V(v)?v.value=i:v=i),width:600},{default:s(()=>[u(e(X),{title:"\u521B\u5EFA\u8868\u5355",closable:""},{default:s(()=>[u(e(N),{vertical:""},{default:s(()=>[Ue,u(e(O),{value:w.value,"onUpdate:value":n[1]||(n[1]=i=>w.value=i),type:"text",placeholder:"\u8F93\u5165\u8868\u5355\u7684\u6807\u9898",clearable:""},null,8,["value"]),Ee,u(e(H),{"on-change":$,"default-upload":!1,accept:".xlsx"},{default:s(()=>[u(e(K),null,{default:s(()=>[L("div",ke,[u(e(Q),{size:"100",depth:3},{default:s(()=>[u(e(W))]),_:1})]),u(e(Y),{style:{"font-size":"16px"}},{default:s(()=>[Ne]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),u(e(z),{show:e(c),"onUpdate:show":n[3]||(n[3]=i=>V(c)?c.value=i:c=i),width:600},{default:s(()=>[u(e(X),{title:"\u5BFC\u5165\u7528\u6237\u81F3 "+e(p).title,closable:""},{default:s(()=>[u(e(N),{vertical:""},{default:s(()=>[Ae,u(e(H),{"on-change":d,"default-upload":!1,accept:".xlsx"},{default:s(()=>[u(e(K),null,{default:s(()=>[L("div",Le,[u(e(Q),{size:"100",depth:3},{default:s(()=>[u(e(W))]),_:1})]),u(e(Y),{style:{"font-size":"16px"}},{default:s(()=>[Te]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])]),_:1})]),_:1}))}});const qe=k("\u9A8C\u8BC1"),Oe=k("\u65B0\u589E\u6570\u636E"),je=k("\u65B0\u589E"),$e=k("\u66F4\u65B0"),Ie=M({setup(j){const m="https://xlsx-collecter-api.imhcg.cn",F={login(t){return`/api/user/${t}/subuser/login`},getSheetColumns(t){return`/api/sheet/${t}/columns`},getRowsFromDb(t){return`/api/sheet/${t}/rows`},insertRowToDb(t){return`/api/sheet/${t}/row/insert`},updateRowToDb(t,l){return`/api/sheet/${t}/row/${l}/update`},deleteRowFromDb(t,l){return`/api/sheet/${t}/row/${l}/delete`},outputToXlsxFile(t,l){return`/api/sheet/${t}/rows/${l}/xlsx`}};let f=h(""),r=h({account:"",password:"",name:()=>localStorage.getItem("name")});h([]);let p=h([]),S=h([]),g=h({}),U=h([]),v=h([]),c=h({subUserLoginVisible:!1,createNewRowDrawerVisible:!1}),B=h("");te();const w=ue();let D=()=>localStorage.getItem("x-api-subuser-code")||"";function $(t){return String(t)}let d={request(t="GET",l="http://",a=void 0,b="application/json"){let y={"x-api-code":D(),"content-type":b};return fetch(l,{method:t,headers:y,body:a,mode:"cors"})},resetLoginStatus(){delete localStorage["x-api-subuser-code"],delete localStorage.name,c.value.subUserLoginVisible=!0},checkSheetIdAndApiCode(){const t=se();t.query.sheet_id&&t.query.sheet_id.length==32?(f.value=$(t.query.sheet_id),console.log("checkSheetIdAndApiCode",f)):location.assign("/"),D?(d.getSubUserColumns(),d.getSubUserRows()):c.value.subUserLoginVisible=!0},sheetSubuserLogin(t){d.request("POST",m+F.login(f.value),JSON.stringify({account:r.value.account,password:r.value.password}),"application/json").then(l=>{if(l.status==200)return l.json().then(a=>{console.log("sheetSubuserLogin",a),localStorage.setItem("x-api-subuser-code",a["x-api-subuser-code"]),localStorage.setItem("name",a.name),t(!0)});t(!1)})},getSubUserRows(){d.request("GET",m+F.getRowsFromDb(f.value),void 0).then(t=>{if(t.status!=200){d.resetLoginStatus();return}else t.json().then(l=>{console.log("getSubUserRows",l),p.value=l})})},resetCurrentRow(){let t=JSON.parse(JSON.stringify(g.value||{}));Object.keys(S).forEach(l=>{t[l]=""}),g.value=t,console.log("resetCurrentRow",g)},getSubUserColumns(){d.request("GET",m+F.getSheetColumns(f.value),void 0).then(t=>{if(t.status!=200){this.resetLoginStatus();return}else t.json().then(l=>{S=l;let a=[];Object.keys(l).forEach(y=>{a.push({key:y,title:l[y].name})}),U.value=a.slice();const b={title:"\u64CD\u4F5C",render(y){let J=[];const re=A(C,{strong:!0,secondary:!0,type:"info",onClick:()=>{console.log("\u66F4\u65B0",y,this),g.value=y,B.value="\u66F4\u65B0",c.value.createNewRowDrawerVisible=!0}},{default:()=>"\u4FEE\u6539"}),ne=A(C,{strong:!0,secondary:!0,type:"info",style:"margin-left:5px;",onClick:()=>{console.log("\u5220\u9664",y),g.value=y,confirm("\u786E\u8BA4\u5220\u9664\u5417?")&&d.deleteRow(de=>{de?d.getSubUserRows():alert("\u5220\u9664\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458")})}},{default:()=>"\u5220\u9664"}),ie=A(C,{strong:!0,secondary:!0,type:"info",style:"margin-left:5px;",onClick:()=>{console.log("\u5BFC\u51FA",y),g.value=y,d.outputToXlsxFile()}},{default:()=>"To Xlsx"});return J.push([re,ne,ie]),J}};a.push(b),v.value=a,console.log("tableColumns",v)})})},insertRow(t){d.request("POST",m+F.insertRowToDb(f.value),JSON.stringify(g.value),"application/json").then(l=>{l.status==200?t(!0):t(!1)})},updateRow(t){d.request("POST",m+F.updateRowToDb(f.value,g.value.rowid),JSON.stringify(g.value),"application/json").then(l=>{l.status==200?t(!0):t(!1)})},deleteRow(t){d.request("POST",m+F.deleteRowFromDb(f.value,g.value.rowid),void 0,"application/json").then(l=>{l.status==200?t(!0):t(!1)})},outputToXlsxFile(){d.request("GET",m+F.outputToXlsxFile(f.value,g.value.rowid),void 0,"application/json").then(t=>{t.status==200&&t.blob().then(l=>{let a=URL.createObjectURL(l),b=document.createElement("a");b.style.display="none",b.href=a,b.download="\u5BFC\u51FA\u6570\u636E-"+g.value[Object.keys(g.value)[1]]+".xlsx",b.click(),URL.revokeObjectURL(a),document.body.removeChild(b)})})}};const o={account:{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"},password:{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:["input","blur"]}},n=h(null),i=h(!1);function x(t){var l;t.preventDefault(),i.value=!0,(l=n.value)==null||l.validate(a=>{a?(console.log(a),w.error("\u8BF7\u5B8C\u5584\u767B\u5F55\u4FE1\u606F")):(console.log("\u5C1D\u8BD5\u767B\u5F55"),d.sheetSubuserLogin(b=>{b?(w.success("\u767B\u5F55\u6210\u529F"),c.value.subUserLoginVisible=!1,i.value=!1,d.getSubUserColumns(),d.getSubUserRows()):(i.value=!1,w.error("\u767B\u5F55\u5931\u8D25"))}))})}const _=h(!1);function G(){_.value=!0,B.value=="\u65B0\u589E"&&d.insertRow(t=>{t?(w.success("\u65B0\u589E\u6210\u529F"),c.value.createNewRowDrawerVisible=!1,_.value=!1,d.getSubUserRows()):(_.value=!1,w.error("\u65B0\u589E\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"))}),B.value=="\u66F4\u65B0"&&d.updateRow(t=>{t?(w.success("\u66F4\u65B0\u6210\u529F"),c.value.createNewRowDrawerVisible=!1,_.value=!1,d.getSubUserRows()):(_.value=!1,w.error("\u66F4\u65B0\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"))}),console.log("saveRow",g)}return ve(()=>{console.log("onMounted"),d.checkSheetIdAndApiCode()}),(t,l)=>(R(),Z(ee,null,[u(e(me),{show:e(c).subUserLoginVisible,"onUpdate:show":l[2]||(l[2]=a=>e(c).subUserLoginVisible=a),"mask-closable":!1,"close-on-esc":!1,"auto-focus":""},{default:s(()=>[u(e(Fe),{style:{width:"600px"},title:"\u9700\u8981\u767B\u5F55",bordered:!0,size:"huge",role:"dialog","aria-modal":"true"},{default:s(()=>[u(e(we),{ref_key:"formRef",ref:n,inline:"","label-width":80,model:e(r),rules:o,size:"medium"},{default:s(()=>[u(e(T),{label:"\u7528\u6237\u540D",path:"account"},{default:s(()=>[u(e(O),{value:e(r).account,"onUpdate:value":l[0]||(l[0]=a=>e(r).account=a),placeholder:"\u8F93\u5165\u8D26\u53F7"},null,8,["value"])]),_:1}),u(e(T),{label:"\u5BC6\u7801",path:"password"},{default:s(()=>[u(e(O),{value:e(r).password,"onUpdate:value":l[1]||(l[1]=a=>e(r).password=a),placeholder:"\u8F93\u5165\u5BC6\u7801"},null,8,["value"])]),_:1}),u(e(T),null,{default:s(()=>[u(e(C),{"attr-type":"button",loading:i.value,onClick:x},{default:s(()=>[qe]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"]),e(D)()?(R(),E(e(N),{key:0,vertical:"",size:"large"},{default:s(()=>[u(e(le),{"content-style":"padding: 24px;"},{default:s(()=>[u(e(N),{justify:"space-between"},{default:s(()=>[u(e(q),{style:{"margin-bottom":"12px"}},{default:s(()=>[u(e(C),{onClick:l[3]||(l[3]=a=>(V(B)?B.value="\u65B0\u589E":B="\u65B0\u589E",e(d).resetCurrentRow(),e(c).createNewRowDrawerVisible=!0))},{default:s(()=>[Oe]),_:1})]),_:1}),u(e(q),{style:{"margin-bottom":"12px"}},{default:s(()=>[u(e(C),{onClick:e(d).resetLoginStatus},{default:s(()=>[k("\u6CE8\u9500 "+be(e(r).name()),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),u(e(ae),null,{default:s(()=>[u(e(oe),{columns:e(v),data:e(p)},null,8,["columns","data"])]),_:1})]),_:1})]),_:1})):I("",!0),u(e(z),{show:e(c).createNewRowDrawerVisible,"onUpdate:show":l[4]||(l[4]=a=>e(c).createNewRowDrawerVisible=a),width:600},{default:s(()=>[u(e(X),{title:e(B),closable:""},{default:s(()=>[u(e(N),{vertical:""},{default:s(()=>[(R(!0),Z(ee,null,Be(e(U),a=>(R(),E(e(T),{key:a.key+"",label:a.title},{default:s(()=>[u(e(O),{value:e(g)[a.key],"onUpdate:value":b=>e(g)[a.key]=b,type:"text",placeholder:a.title,clearable:""},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["label"]))),128)),u(e(q),{style:{"margin-bottom":"12px"}},{default:s(()=>[e(B)=="\u65B0\u589E"?(R(),E(e(C),{key:0,loading:_.value,onClick:G},{default:s(()=>[je]),_:1},8,["loading"])):I("",!0),e(B)=="\u66F4\u65B0"?(R(),E(e(C),{key:1,loading:_.value,onClick:G},{default:s(()=>[$e]),_:1},8,["loading"])):I("",!0)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])],64))}}),Xe=_e({history:ye(),routes:[{path:"/",name:"user",component:Ve},{path:"/sheet",name:"sheet",component:Ie}]}),P=Ce(Re);P.use(Se());P.use(Xe);P.mount("#app");
