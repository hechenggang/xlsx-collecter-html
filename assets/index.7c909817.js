import{d as X,o as S,c as D,w as s,S as ne,a as u,r as ie,u as e,N as de,R as ce,b as Y,e as pe,f as g,g as Z,h as E,i as ee,j as te,k as y,l as T,m as V,n as ue,p as se,q as $,s as q,t as P,v as G,x as A,y as J,A as H,z as K,B as I,C as U,D as k,E as fe,F as he,G as Q,H as ge,I as j,J as W,K as me,L,M as ve,O as Fe,P as we,Q as be,T as Be,U as _e,V as ye}from"./vendor.8c545cf1.js";const Ce=function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))p(r);new MutationObserver(r=>{for(const f of r)if(f.type==="childList")for(const C of f.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&p(C)}).observe(document,{childList:!0,subtree:!0});function F(r){const f={};return r.integrity&&(f.integrity=r.integrity),r.referrerpolicy&&(f.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?f.credentials="include":r.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function p(r){if(r.ep)return;r.ep=!0;const f=F(r);fetch(r.href,f)}};Ce();const Se=X({setup(O){return(v,F)=>(S(),D(e(ce),null,{default:s(({Component:p})=>[(S(),D(ne,null,{default:s(()=>[u(e(de),null,{default:s(()=>[(S(),D(ie(p)))]),_:2},1024)]),_:2},1024))]),_:1}))}});const xe=U("\u65B0\u5EFA\u8868\u5355"),Re=A("p",null,"\u7B2C\u4E00\u6B65 \u8BF7\u8F93\u5165\u6807\u9898",-1),De=A("p",null,"\u7B2C\u4E8C\u6B65 \u8BF7\u4E0A\u4F20\u5236\u4F5C\u597D\u7684\u8868\u5355\u6A21\u677F\u6587\u4EF6",-1),Ue={style:{"margin-bottom":"12px"}},Ee=U("\u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20"),ke=A("p",null,"\u8BF7\u4E0A\u4F20\u5236\u4F5C\u597D\u7684\u7528\u6237\u5BFC\u5165\u6A21\u677F\u6587\u4EF6",-1),Ne={style:{"margin-bottom":"12px"}},Ae=U("\u70B9\u51FB\u6216\u8005\u62D6\u52A8\u6587\u4EF6\u5230\u8BE5\u533A\u57DF\u6765\u4E0A\u4F20"),Le=X({setup(O){const v=Y();let F=pe(()=>localStorage.getItem("x-api-code")),p="https://xlsx-collecter-api.imhcg.cn",r={loginByAccount:"https://account.imhcg.cn/to/aae1cf3cb358fab3f0685775655dc000",getUserSheets:"/api/user/sheets",createSheetByXlsx:"/api/sheet/create",importSubusersFormXlsx(a){return`/api/user/${a}/subusers/import`}},f=g([]),C=g({}),c={request(a="GET",n="http://",d=void 0){return fetch(n,{method:a,headers:{"x-api-code":F.value},body:d,mode:"cors"})},checkLocalApiCode(){const a=ee();a.query.code&&a.query.code.length===129?localStorage.setItem("x-api-code",a.query.code):F.value==null&&location.assign(r.loginByAccount)},createSheetByXlsx(a,n){this.request("POST",p+r.createSheetByXlsx,a).then(d=>{d.status===200?n(!0):n(!1)})},createSubUserByXlsx(a,n){this.request("POST",p+r.importSubusersFormXlsx(C.value.id),a).then(d=>{d.status===200?n(!0):n(!1)})},getUserSheets(){this.request("GET",p+r.getUserSheets,void 0).then(a=>{a.status==200&&a.json().then(n=>{f.value=[],Object.keys(n).forEach(d=>{f.value.push({id:d,title:n[d].title,create_at:n[d].create_at})})})})}};c.checkLocalApiCode(),c.getUserSheets();let h=g(!1),_=g(!1);const w=[{title:"\u540D\u79F0",key:"title",render(a){return k(y,{strong:!0,secondary:!0,size:"medium",type:"info",onClick:()=>v.push("/sheet?sheet_id="+a.id)},{default:()=>a.title})}},{title:"\u6807\u8BC6",key:"id"},{title:"\u521B\u5EFA\u65F6\u95F4",key:"create_at",render(a){return k(fe,{time:a.create_at,format:"yyyy-MM-dd HH:mm:ss"})}},{title:"\u64CD\u4F5C",render(a){return k(y,{strong:!0,secondary:!0,size:"medium",type:"info",onClick:()=>{C.value=a,_.value=!0}},{default:()=>"\u5BFC\u5165\u6570\u636E\u5F55\u5165\u5458"})}}],m=g(""),b=Z();function N(a,n,d){if(console.log(m),m.value==""){b.warning("\u8BF7\u586B\u5199\u6807\u9898");return}console.log(a,n,d);var x=new FormData;x.append("file",a.file.file),x.append("title",m.value),c.createSheetByXlsx(x,t=>{t?(b.success("\u65B0\u5EFA\u6210\u529F"),c.getUserSheets(),h.value=!h.value):(b.warning("\u65B0\u5EFA\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"),h.value=!h.value)})}function i(a,n,d){console.log(a,n,d);var x=new FormData;x.append("file",a.file.file),c.createSubUserByXlsx(x,t=>{t?(b.success("\u5BFC\u5165\u6210\u529F"),_.value=!1):(b.warning("\u5BFC\u5165\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"),_.value=!1)})}return(a,n)=>(S(),D(e(E),{vertical:"",size:"large"},{default:s(()=>[u(e(te),{"content-style":"padding: 24px;"},{default:s(()=>[u(e(V),{style:{"margin-bottom":"12px"}},{default:s(()=>[u(e(y),{onClick:n[0]||(n[0]=d=>T(h)?h.value=!e(h):h=!e(h))},{default:s(()=>[xe]),_:1})]),_:1}),u(e(se),null,{default:s(()=>[u(e(ue),{columns:w,data:e(f)},null,8,["data"])]),_:1}),u(e(I),{show:e(h),"onUpdate:show":n[2]||(n[2]=d=>T(h)?h.value=d:h=d),width:600},{default:s(()=>[u(e($),{title:"\u521B\u5EFA\u8868\u5355",closable:""},{default:s(()=>[u(e(E),{vertical:""},{default:s(()=>[Re,u(e(q),{value:m.value,"onUpdate:value":n[1]||(n[1]=d=>m.value=d),type:"text",placeholder:"\u8F93\u5165\u8868\u5355\u7684\u6807\u9898",clearable:""},null,8,["value"]),De,u(e(P),{"on-change":N,"default-upload":!1,accept:".xlsx"},{default:s(()=>[u(e(G),null,{default:s(()=>[A("div",Ue,[u(e(J),{size:"100",depth:3},{default:s(()=>[u(e(H))]),_:1})]),u(e(K),{style:{"font-size":"16px"}},{default:s(()=>[Ee]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),u(e(I),{show:e(_),"onUpdate:show":n[3]||(n[3]=d=>T(_)?_.value=d:_=d),width:600},{default:s(()=>[u(e($),{title:"\u5BFC\u5165\u7528\u6237\u81F3 "+e(C).title,closable:""},{default:s(()=>[u(e(E),{vertical:""},{default:s(()=>[ke,u(e(P),{"on-change":i,"default-upload":!1,accept:".xlsx"},{default:s(()=>[u(e(G),null,{default:s(()=>[A("div",Ne,[u(e(J),{size:"100",depth:3},{default:s(()=>[u(e(H))]),_:1})]),u(e(K),{style:{"font-size":"16px"}},{default:s(()=>[Ae]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])]),_:1})]),_:1}))}});const Te=U("\u9A8C\u8BC1"),Ve=U("\u65B0\u589E\u6570\u636E"),qe=U("\u65B0\u589E"),Oe=U("\u66F4\u65B0"),je=X({setup(O){const v="https://xlsx-collecter-api.imhcg.cn",F={login(t){return`/api/user/${t}/subuser/login`},getSheetColumns(t){return`/api/sheet/${t}/columns`},getRowsFromDb(t){return`/api/sheet/${t}/rows`},insertRowToDb(t){return`/api/sheet/${t}/row/insert`},updateRowToDb(t,l){return`/api/sheet/${t}/row/${l}/update`},deleteRowFromDb(t,l){return`/api/sheet/${t}/row/${l}/delete`},outputToXlsxFile(t,l){return`/api/sheet/${t}/rows/${l}/xlsx`}};let p=g(""),r=g({account:"",password:"",name:()=>localStorage.getItem("name")});g([]);let f=g([]),C=g([]),c=g({}),h=g([]),_=g([]),w=g({subUserLoginVisible:!1,createNewRowDrawerVisible:!1}),m=g("");Y();const b=Z();let N=()=>localStorage.getItem("x-api-subuser-code"),i={request(t="GET",l="http://",o=void 0,B="application/json"){return fetch(l,{method:t,headers:{"x-api-subuser-code":N(),"content-type":B},body:o,mode:"cors"})},resetLoginStatus(){delete localStorage["x-api-subuser-code"],delete localStorage.name,w.value.subUserLoginVisible=!0},checkSheetIdAndApiCode(){const t=ee();t.query.sheet_id&&t.query.sheet_id.length==32?(p.value=t.query.sheet_id,console.log("checkSheetIdAndApiCode",p)):location.assign("/"),N?(i.getSubUserColumns(),i.getSubUserRows()):w.value.subUserLoginVisible=!0},sheetSubuserLogin(t){i.request("POST",v+F.login(p.value),JSON.stringify({account:r.value.account,password:r.value.password}),"application/json").then(l=>{if(l.status==200)return l.json().then(o=>{console.log("sheetSubuserLogin",o),localStorage.setItem("x-api-subuser-code",o["x-api-subuser-code"]),localStorage.setItem("name",o.name),t(!0)});t(!1)})},getSubUserRows(){i.request("GET",v+F.getRowsFromDb(p.value),void 0).then(t=>{if(t.status!=200){i.resetLoginStatus();return}else t.json().then(l=>{console.log("getSubUserRows",l),f.value=l})})},resetCurrentRow(){let t=JSON.parse(JSON.stringify(c.value||{}));Object.keys(C).forEach(l=>{t[l]=""}),c.value=t,console.log("resetCurrentRow",c)},getSubUserColumns(){i.request("GET",v+F.getSheetColumns(p.value),void 0).then(t=>{if(t.status!=200){this.resetLoginStatus();return}else t.json().then(l=>{C=l;let o=[];Object.keys(l).forEach(R=>{o.push({key:R,title:l[R].name})}),h.value=o.slice();const B={title:"\u64CD\u4F5C",render(R){let M=[];const le=k(y,{strong:!0,secondary:!0,type:"info",onClick:()=>{console.log("\u66F4\u65B0",R,this),c.value=R,m.value="\u66F4\u65B0",w.value.createNewRowDrawerVisible=!0}},{default:()=>"\u4FEE\u6539"}),oe=k(y,{strong:!0,secondary:!0,type:"info",style:"margin-left:5px;",onClick:()=>{console.log("\u5220\u9664",R),c.value=R,confirm("\u786E\u8BA4\u5220\u9664\u5417?")&&i.deleteRow(re=>{re?i.getSubUserRows():alert("\u5220\u9664\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458")})}},{default:()=>"\u5220\u9664"}),ae=k(y,{strong:!0,secondary:!0,type:"info",style:"margin-left:5px;",onClick:()=>{console.log("\u5BFC\u51FA",R),c.value=R,i.outputToXlsxFile()}},{default:()=>"To Xlsx"});return M.push([le,oe,ae]),M}};o.push(B),_.value=o,console.log("tableColumns",_)})})},insertRow(t){i.request("POST",v+F.insertRowToDb(p.value),JSON.stringify(c.value),"application/json").then(l=>{l.status==200?t(!0):t(!1)})},updateRow(t){i.request("POST",v+F.updateRowToDb(p.value,c.value.rowid),JSON.stringify(c.value),"application/json").then(l=>{l.status==200?t(!0):t(!1)})},deleteRow(t){i.request("POST",v+F.deleteRowFromDb(p.value,c.value.rowid),void 0,"application/json").then(l=>{l.status==200?t(!0):t(!1)})},outputToXlsxFile(){i.request("GET",v+F.outputToXlsxFile(p.value,c.value.rowid),void 0,"application/json").then(t=>{t.status==200&&t.blob().then(l=>{let o=URL.createObjectURL(l),B=document.createElement("a");B.style.display="none",B.href=o,B.download="\u5BFC\u51FA\u6570\u636E-"+c.value[Object.keys(c.value)[1]]+".xlsx",B.click(),URL.revokeObjectURL(o),document.body.removeChild(B)})})}};const a={account:{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"},password:{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:["input","blur"]}},n=g(null);function d(t){var l;t.preventDefault(),(l=n.value)==null||l.validate(o=>{o?(console.log(o),b.error("\u8BF7\u5B8C\u5584\u767B\u5F55\u4FE1\u606F")):(console.log("\u5C1D\u8BD5\u767B\u5F55"),i.sheetSubuserLogin(B=>{B?(b.success("\u767B\u5F55\u6210\u529F"),w.value.subUserLoginVisible=!1,i.getSubUserColumns(),i.getSubUserRows()):b.error("\u767B\u5F55\u5931\u8D25")}))})}function x(){m.value=="\u65B0\u589E"&&i.insertRow(t=>{t?(b.success("\u65B0\u589E\u6210\u529F"),w.value.createNewRowDrawerVisible=!1,i.getSubUserRows()):b.error("\u65B0\u589E\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458")}),m.value=="\u66F4\u65B0"&&i.updateRow(t=>{t?(b.success("\u66F4\u65B0\u6210\u529F"),w.value.createNewRowDrawerVisible=!1,i.getSubUserRows()):b.error("\u66F4\u65B0\u5931\u8D25 \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458")}),console.log("saveRow",c)}return he(()=>{console.log("onMounted"),i.checkSheetIdAndApiCode()}),(t,l)=>(S(),Q(W,null,[u(e(ge),{show:e(w).subUserLoginVisible,"onUpdate:show":l[2]||(l[2]=o=>e(w).subUserLoginVisible=o),"mask-closable":!1,"close-on-esc":!1,"auto-focus":""},{default:s(()=>[u(e(me),{style:{width:"600px"},title:"\u9700\u8981\u767B\u5F55",bordered:!0,size:"huge",role:"dialog","aria-modal":"true"},{default:s(()=>[u(e(ve),{ref_key:"formRef",ref:n,inline:"","label-width":80,model:e(r),rules:a,size:"medium"},{default:s(()=>[u(e(L),{label:"\u7528\u6237\u540D",path:"account"},{default:s(()=>[u(e(q),{value:e(r).account,"onUpdate:value":l[0]||(l[0]=o=>e(r).account=o),placeholder:"\u8F93\u5165\u8D26\u53F7"},null,8,["value"])]),_:1}),u(e(L),{label:"\u5BC6\u7801",path:"password"},{default:s(()=>[u(e(q),{value:e(r).password,"onUpdate:value":l[1]||(l[1]=o=>e(r).password=o),placeholder:"\u8F93\u5165\u5BC6\u7801"},null,8,["value"])]),_:1}),u(e(L),null,{default:s(()=>[u(e(y),{"attr-type":"button",onClick:d},{default:s(()=>[Te]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"]),e(N)()?(S(),D(e(E),{key:0,vertical:"",size:"large"},{default:s(()=>[u(e(te),{"content-style":"padding: 24px;"},{default:s(()=>[u(e(E),{justify:"space-between"},{default:s(()=>[u(e(V),{style:{"margin-bottom":"12px"}},{default:s(()=>[u(e(y),{onClick:l[3]||(l[3]=o=>(T(m)?m.value="\u65B0\u589E":m="\u65B0\u589E",e(i).resetCurrentRow(),e(w).createNewRowDrawerVisible=!0))},{default:s(()=>[Ve]),_:1})]),_:1}),u(e(V),{style:{"margin-bottom":"12px"}},{default:s(()=>[u(e(y),{onClick:e(i).resetLoginStatus},{default:s(()=>[U("\u6CE8\u9500 "+Fe(e(r).name()),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),u(e(se),null,{default:s(()=>[u(e(ue),{columns:e(_),data:e(f)},null,8,["columns","data"])]),_:1})]),_:1})]),_:1})):j("",!0),u(e(I),{show:e(w).createNewRowDrawerVisible,"onUpdate:show":l[4]||(l[4]=o=>e(w).createNewRowDrawerVisible=o),width:600},{default:s(()=>[u(e($),{title:e(m),closable:""},{default:s(()=>[u(e(E),{vertical:""},{default:s(()=>[(S(!0),Q(W,null,we(e(h),o=>(S(),D(e(L),{key:o.key+"",label:o.title},{default:s(()=>[u(e(q),{value:e(c)[o.key],"onUpdate:value":B=>e(c)[o.key]=B,type:"text",placeholder:o.title,clearable:""},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["label"]))),128)),u(e(V),{style:{"margin-bottom":"12px"}},{default:s(()=>[e(m)=="\u65B0\u589E"?(S(),D(e(y),{key:0,onClick:x},{default:s(()=>[qe]),_:1})):j("",!0),e(m)=="\u66F4\u65B0"?(S(),D(e(y),{key:1,onClick:x},{default:s(()=>[Oe]),_:1})):j("",!0)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])],64))}}),$e=be({history:Be(),routes:[{path:"/",name:"user",component:Le},{path:"/sheet",name:"sheet",component:je}]}),z=_e(Se);z.use(ye());z.use($e);z.mount("#app");
